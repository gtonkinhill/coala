---
title: "Introduction to coalsimr"
author: "Paul Staab"
date: "coalsimr `r packageVersion('coalsimr')`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

Coalescent simulation referrers to the idea to simulate the evolution of 
biological sequences like DNA by tracing their ancestry back in time. The
`coalsimr` package is an interface for calling a number of commonly used
coalescent simulators from R.

# Creating a model
Use the function `coal_model` to create a basic coalescent model:

```{r}
library(coalsimr)
model <- coal_model(sample_size = 5, loci_number = 1)
```

This creates a basic model with one population of constant size.
Simulated is one genetic locus in 5 haplotypes taken from the population. 

Printing the model gives a short summary of this content:
```{r}
print(model)
```

Models consist of 

* _features_, which represent evolutionary forces and events present in the 
  model, 
* _parameters_, which are the model parameters, 
* _loci_, which describe the genetic regions that are simualted and 
* _summary statistics_, which describe the format of the simulated data.

In order to simulate the model we need to add a few more features and at least
one summary statistic.


# Adding features
For simulating sequences, we need to add mutations to the model. To do so,
we create a corresponding feature using `feat_mutation` and add it to the
existing model using the plus operator:

```{r}
model <- model + feat_mutation(rate = 1, model = "IFS")
model
```

Now, mutation occur with rate 1 and accoring to an infinite-sites mutation 
model (IFS). Details on both rate and mutation model are given the help
page of the feature (`?feat_mutation`). 

Coalsimr currently support the features

```{r echo=FALSE}
funcs <- ls("package:coalsimr")
funcs[grep("^feat_", funcs)]
```

However, not all combination of all features might be possible. Please refer 
to the features help pages for detailed information.


# Adding Summary Statistics

Adding summary statistics works in a similar fashion as adding features:

```{r}
model <- model + sumstat_seg_sites()
model
```

This adds the _segregating sites_ summary statistic to the model, which is a
basic summary statisic in population genetics. Again, refer to 
`?sumstat_seg_sites` for details.

Available summary statistics are:

```{r echo=FALSE}
funcs[grep("^sumstat_", funcs)]
```



# Simulating the model

We now can simulate the model. The printed output of a model contains information
which program will be used for the simulation and which arguments will be used.
As coalsimr is in a early stage, please make sure to always check both. 

The
function `simulate` will call the program with the printed options, parse its
output and caluclated the added summary statistics:

```{r}
set.seed(123)
sumstats <- simulate(model)
```

The returned object `sumstats` a list, in which each entry corresponds to one 
summary statistic. As there is only one summary statistic in our model, 
it has only one entry:

```{r}
names(sumstats)
```

The structure in `sumstats$seg_sites` is given by the segregating sites 
statistic. It is again a list, where each entry repesents one locus. For each 
locus, it contains a matrix as specified in `?sumstat_seg_sites`:

```{r}
sumstats$seg_sites[[1]]
```


